<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>شادوینگ پلیر</title>
  <style>
    /* فونت شبیه گوگل */
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');

    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      background-color: white;
      color: #202124;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      align-items: center;
      justify-content: flex-start;
      padding: 20px 10px;
    }
    h1 {
      margin-bottom: 30px;
      font-weight: 400;
      font-size: 26px;
      color: #202124;
      text-align: center;
      text-shadow: 0 1px 1px rgba(0,0,0,0.1);
    }
    .container {
      width: 100%;
      max-width: 450px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    label {
      font-weight: 500;
      margin-bottom: 5px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border: 1.5px solid #dadce0;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
      outline-offset: 2px;
      transition: border-color 0.3s;
    }
    input[type="text"]:focus {
      border-color: #1a73e8;
      outline: none;
    }
    textarea {
      padding: 10px;
      font-size: 16px;
      border: 1.5px solid #dadce0;
      border-radius: 4px;
      width: 100%;
      height: 120px;
      resize: vertical;
      box-sizing: border-box;
      outline-offset: 2px;
      transition: border-color 0.3s;
      font-family: 'Roboto', sans-serif;
    }
    textarea:focus {
      border-color: #1a73e8;
      outline: none;
    }
    .row {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    button {
      background-color: #34a853;
      border: none;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    button:hover:not(:disabled) {
      background-color: #2c8c46;
    }
    button:disabled {
      background-color: #a0c79f;
      cursor: default;
    }
    video {
      width: 100%;
      max-height: 240px;
      background: black;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 15px;
    }
    .subtitle-box {
      margin-top: 10px;
      padding: 10px;
      background-color: #f1f3f4;
      border-radius: 6px;
      font-size: 17px;
      min-height: 50px;
      line-height: 1.4;
      color: #3c4043;
      user-select: none;
    }
    footer {
      margin-top: auto;
      padding: 15px 0;
      font-family: 'Caveat', cursive;
      font-size: 18px;
      color: #5f6368;
      user-select: none;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>شادوینگ پلیر</h1>
  <div class="container">
    <label for="youtubeLink">لینک یوتیوب را وارد کنید:</label>
    <div class="row">
      <input type="text" id="youtubeLink" placeholder="https://www.youtube.com/watch?v=..." />
      <button id="loadBtn">بارگذاری</button>
    </div>

    <label for="scriptInput">متن اسکریپت (هر جمله در خط جدا):</label>
    <textarea id="scriptInput" placeholder="هر جمله را در یک خط بنویسید..."></textarea>

    <video id="videoPlayer" controls style="display:none;"></video>

    <button id="calibrateBtn" style="margin-top:10px;display:none;">کالیبراسیون</button>

    <div class="controls" style="display:none;">
      <button id="prevBtn">قبلی</button>
      <button id="playSegmentBtn">پخش</button>
      <button id="nextBtn">بعدی</button>
    </div>

    <div class="subtitle-box" id="subtitleBox" style="display:none;"></div>
  </div>

  <footer>created by wrya zrebar</footer>

  <script>
    const video = document.getElementById('videoPlayer');
    const loadBtn = document.getElementById('loadBtn');
    const calibrateBtn = document.getElementById('calibrateBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const playSegmentBtn = document.getElementById('playSegmentBtn');
    const youtubeLinkInput = document.getElementById('youtubeLink');
    const scriptInput = document.getElementById('scriptInput');
    const subtitleBox = document.getElementById('subtitleBox');
    const controlsDiv = document.querySelector('.controls');

    let segments = [];
    let currentIndex = 0;
    let isPlayingSegment = false;

    // تبدیل لینک یوتیوب به آدرس ویدئو قابل پخش در تگ video
    function getEmbedUrl(youtubeUrl) {
      const videoIdMatch = youtubeUrl.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
      if (videoIdMatch && videoIdMatch[1]) {
        return `https://www.youtube.com/embed/${videoIdMatch[1]}?enablejsapi=1&origin=${location.origin}`;
      }
      return null;
    }

    // بارگذاری ویدیو در iframe
    function loadVideo() {
      const url = youtubeLinkInput.value.trim();
      if (!url) {
        alert('لطفاً لینک یوتیوب را وارد کنید.');
        return;
      }

      // فقط برای نمایش ساده از iframe استفاده نمی‌کنیم چون کنترل کامل نداریم
      // استفاده از تگ video با لینک مستقیم mp4 نیاز به تبدیل و API پیچیده داره
      // پس اینجا به جای بارگذاری ویدئو واقعی، فقط نمایش پیام می‌دیم (نمادین)

      // بنابراین ما یک ویدئو ساده HTML5 می‌گذاریم که src را تغییر می‌دهد (اگر لینک mp4 داشته باشیم)

      // چون لینک یوتیوب مستقیم نیست، ما ویدئو را نمایش نمی‌دهیم، ولی کادر ویدئو را نشان می‌دهیم

      alert('امکان پخش مستقیم ویدئوهای یوتیوب در این نمونه وجود ندارد. لطفاً این بخش را به سرویس پخش مخصوص متصل کنید.');

      // نمایش کادر ویدئو خام
      video.style.display = 'block';
      calibrateBtn.style.display = 'inline-block';
      controlsDiv.style.display = 'flex';
      subtitleBox.style.display = 'block';

      // فعال کردن دکمه‌ها
      prevBtn.disabled = false;
      nextBtn.disabled = false;
      playSegmentBtn.disabled = false;
    }

    // ساخت آرایه جملات از متن اسکریپت
    function buildSegmentsFromScript() {
      const lines = scriptInput.value.split('\n').map(l => l.trim()).filter(l => l.length > 0);
      segments = lines.map(line => ({ text: line }));
      currentIndex = 0;
    }

    // نمایش جمله فعلی
    function showCurrentSegment() {
      if (!segments.length) return;
      subtitleBox.textContent = segments[currentIndex].text;
    }

    // پخش جمله (این فقط نمونه است، چون ویدئو نداریم)
    function playCurrentSegment() {
      if (!segments.length) return;
      isPlayingSegment = true;
      showCurrentSegment();
      // فرض کنیم هر جمله 3 ثانیه طول می‌کشد
      playSegmentBtn.textContent = 'در حال پخش...';
      setTimeout(() => {
        isPlayingSegment = false;
        playSegmentBtn.textContent = 'پخش';
      }, 3000);
    }

    // دکمه‌ها
    loadBtn.addEventListener('click', () => {
      loadVideo();
      buildSegmentsFromScript();
      showCurrentSegment();
    });

    calibrateBtn.addEventListener('click', () => {
      alert('عملیات کالیبراسیون انجام شد (نمادین).');
    });

    prevBtn.addEventListener('click', () => {
      if (isPlayingSegment) return;
      if (currentIndex > 0) {
        currentIndex--;
        showCurrentSegment();
        playCurrentSegment();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (isPlayingSegment) return;
      if (currentIndex < segments.length - 1) {
        currentIndex++;
        showCurrentSegment();
        playCurrentSegment();
      }
    });

    playSegmentBtn.addEventListener('click', () => {
      if (!isPlayingSegment) {
        playCurrentSegment();
      }
    });
  </script>
</body>
</html>
